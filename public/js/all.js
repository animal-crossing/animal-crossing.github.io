!function(){"use strict";hello.init({google:"938000328729-l8ora04d42634g8ln8d77mvgtt1g011d.apps.googleusercontent.com"}),angular.module("app",["ui.bootstrap","ngAnimate","ngRoute","ngResource","angular-loading-bar","LocalStorageModule"]).config(["$routeProvider","localStorageServiceProvider",function(e,r){e.when("/",{templateUrl:"public/app/views/index.html",controller:"mainController",resolve:{session:["storageService",function(e){return e.getStorageService(!0)}]}}).when("/auth",{template:" ",controller:"authController",resolve:{userModel:["authService",function(e){return e.auth()}],session:["storageService",function(e){return e.getStorageService(!0)}]}}).when("/visit",{templateUrl:"public/app/views/visit_village.html",controller:"villageController",resolve:{users:["userService",function(e){return e.Users.query().$promise.then(function(e){return e})}]}}).when("/about",{templateUrl:"public/app/views/about.html",controller:"aboutController"}).when("/:user/:action?",{templateUrl:"public/app/views/collection.html",controller:"collectionController",resolve:{isLoggedIn:["authService",function(e){return e.isLoggedIn()}],session:["storageService",function(e){return e.getStorageService(!0)}]}}).otherwise({redirectTo:"/"}),r.setPrefix("ac").setStorageCookieDomain("http://animal-crossing.github.io")}])}(),function(){"use strict";angular.module("app").controller("aboutController",["$scope",function(e){}])}(),function(){"use strict";angular.module("app").controller("authController",["$scope","$location","$log","userModel","userService","session","storageService",function(e,r,o,t,n,i,a){function s(){i&&a.createSession(i)}function c(e){n.userCollection.query({userCollection:e.collection},function(r){n.userModel.id=e.id,n.userModel.name=e.name,n.userModel.username=e.username,n.userModel.avatar=e.avatar,n.userModel.collection=e.collection,s(),n.userModel.cards=r,l(n.userModel.username)})}function l(e){n.destroyNeighbor(),n.userModel.preview=!1,r.path("/"+e)}i&&a.populateStorageData(i),t=n.userModel,t.id?t.collection?c(t):n.Users.query(function(e){var r=TAFFY(e),o=r({id:t.id}).first();o?c(o):n.postUserCollection.save(t.cards,function(e){for(t.collection=e.uri.substr(e.uri.lastIndexOf("/")+1);r({username:t.username}).first();)t.username=t.username+Math.floor(900*Math.random())+100;r.insert({id:t.id,name:t.name,username:t.username,avatar:t.avatar,collection:t.collection}),n.Users.update({},r().stringify()),s(),l(t.username)})}):l("")}])}(),function(){"use strict";angular.module("app").factory("authService",["$location","$q","userService","storageService",function(e,r,o,t){return{auth:function(){var e=r.defer(),n=o.userModel,i=t.getStorageService();return!n.id||i&&!i.get("id")?hello("google").login().then(function(r){n.access_token=r.authResponse.access_token,n.client_id=r.authResponse.client_id,n.network=r.network,i.set("access_token",r.authResponse.access_token),i.set("client_id",r.authResponse.client_id),i.set("network",r.network),hello(r.network).api("/me").then(function(r){r.name&&e.resolve(""),n.id=r.id,n.name=r.name;var o=r.name.replace(/\s+/g,"");o.length>15&&(o=r.first_name.split(" ")[0].slice(0,15)),n.username=o,n.avatar=r.image.url.slice(0,-2)+"150",i.set("id",n.id),i.set("name",n.name),i.set("username",n.username),i.set("avatar",n.avatar),e.resolve(!0)})},function(r){e.resolve(!1)}):hello("google").logout().then(function(){o.init(),i.clearAll(),e.resolve("")}),e.promise},isLoggedIn:function(){var e=r.defer(),n=t.getStorageService();return n&&!o.userModel.id&&t.populateStorageData(n),o.userModel.id?e.resolve(!0):e.resolve(!1),e.promise}}}])}(),function(){"use strict";angular.module("app").controller("mainController",["$scope","userService","session","storageService","$location",function(e,r,o,t,n){if(e.series=1,o&&o.get("id"))t.populateStorageData(o),n.path("/"+o.get("username"));else{var i=r.userModel;i.cards?e.cards=i.cards:r.getDefaultCollection.get(function(r){i.cards=r.cards,e.cards=r.cards})}}])}(),function(){"use strict";angular.module("app").controller("menuController",["$scope","userService",function(e,r){e.isCollapsed=!0,e.$watch(function(){return r.userModel},function(r,o){e.userModel=r},!0),e.$watch(function(){return r.neighbor},function(r,o){e.neighbor=r},!0),e.collapse=function(){e.isCollapsed=!0}}])}(),function(){"use strict";angular.module("app").factory("storageService",["localStorageService","userService","$q",function(e,r,o){return{getStorageService:function(r){var r=r||!1,t=o.defer();if(e.isSupported){if(!r)return e;t.resolve(e)}else if(e.cookie.isSupported){if(!r)return e.cookie;t.resolve(e.cookie)}else{if(!r)return!1;t.resolve(!1)}return t.promise},populateStorageData:function(e){r.userModel.id=e.get("id"),r.userModel.name=e.get("name"),r.userModel.username=e.get("username"),r.userModel.avatar=e.get("avatar"),r.userModel.collection=e.get("collection"),r.userModel.access_token=e.get("access_token"),r.userModel.network=e.get("network"),r.userModel.client_id=e.get("client_id")},createSession:function(e){e.set("id",r.userModel.id),e.set("name",r.userModel.name),e.set("username",r.userModel.username),e.set("avatar",r.userModel.avatar),e.set("collection",r.userModel.collection),e.set("access_token",r.userModel.access_token),e.set("network",r.userModel.network),e.set("client_id",r.userModel.client_id)}}}])}(),function(){"use strict";angular.module("app").factory("userService",["$resource",function(e){var r="https://api.myjson.com/bins",o={};return o.init=function(){o.userModel={id:"",name:"",username:"",avatar:"",cards:!1,collection:"",access_token:"",network:"",client_id:"",preview:!1,changed:!1,serie:1}},o.destroyNeighbor=function(){o.neighbor={avatar:"",username:"",cards:!1,collection:""}},o.init(),o.destroyNeighbor(),o.Users=e(r+"/1wizj",{},{update:{method:"PUT",isArray:!0}}),o.getDefaultCollection=e(r+"/u0eb"),o.userCollection=e(r+"/:userCollection",{userCollection:"@collection"},{update:{method:"PUT",isArray:!0}}),o.getSeries2=e(r+"/1u829"),o.getSeries3=e(r+"/3c14z"),o.getSeries4=e(r+"/e14cf"),o.postUserCollection=e(r),o}])}(),function(){"use strict";angular.module("app").controller("villageController",["$scope","users","$location",function(e,r,o){e.villager={username:""},e.limit=25,e.showMore=function(){e.limit+=25},e.users=r,e.goToVillage=function(e){o.path("/"+e+"/collection")}}])}(),function(){"use strict";angular.module("app").controller("collectionController",["$scope","userService","isLoggedIn","$location","$routeParams",function(e,r,o,t,n){function i(o,t){100!=o.cards.length||t?200!=o.cards.length||t?300!=o.cards.length||t?e.collection=o.cards:r.getSeries4.query(function(e){a(o,e)}):r.getSeries3.query(function(e){a(o,e)}):r.getSeries2.query(function(e){a(o,e)}),e.avatar=o.avatar,e.username=o.username}function a(o,t){e.collection=o.cards.concat(t),u.cards=e.collection,r.userCollection.update({userCollection:u.collection},e.collection)}function s(r){u.changed=r,e.changed=u.changed}function c(){e.series=u.serie}angular.element(document).ready(function(){new ShareButton({url:"animal-crossing.github.io/#/"+n.user+"/"+n.action,description:"Check "+n.user+" "+n.action+" Animal Crossing cards",networks:{pinterest:{enabled:!1},linkedin:{enabled:!1},reddit:{enabled:!1},email:{enabled:!1}}})});var l=n.user;e.action=n.action;var u=r.userModel,d=r.neighbor;e.changed=u.changed,c(),l!=u.username?u.preview&&l==d.username?i(d,!0):r.Users.query(function(e){var o=TAFFY(e),n=o({username:l}).first();n?r.userCollection.query({userCollection:n.collection},function(e){d.cards=e,d.username=n.username,d.avatar=n.avatar,d.collection=n.collection,i(d,!0),u.preview=!0}):(u.preview=!1,r.destroyNeighbor(),t.path("/"))}):i(u),o&&l==u.username&&(r.destroyNeighbor(),u.preview=!1),o&&l==u.username&&!u.cards&&r.userCollection.query({userCollection:u.collection},function(e){u.cards=e,i(u)}),e.$watch(function(){return r.userModel.preview},function(r,o){e.preview=r}),e.updateOwn=function(e){e.own=!e.own,s(!0)},e.updateFav=function(e){e.favorite=!e.favorite,s(!0)},e.updateRepeated=function(e){e.repeated=!e.repeated,s(!0)},e.saveChanges=function(){r.userCollection.update({userCollection:u.collection},u.cards),s(!1)},e.changeSeries=function(e){u.serie=e}}])}(),function(){"use strict";angular.module("app").filter("byAction",function(){return function(e,r,o){var t=[];return void 0===r?e:(angular.forEach(e,function(e){switch(r){case"collection":!!e.own&&t.push(e);break;case"favorites":!!e.favorite&&t.push(e);break;case"missing":o?!(e.own||!e.favorite)&&t.push(e):!e.own&&t.push(e);break;case"repeated":!!e.repeated&&t.push(e)}}),t)}}).filter("bySerie",function(){return function(e,r){if(e){r=r||1;var o=[];switch(r){case 1:o=e.slice(0,100);break;case 2:o=e.slice(100,200);break;case 3:o=e.slice(200,300);break;case 4:o=e.slice(300,400)}return o}}})}();